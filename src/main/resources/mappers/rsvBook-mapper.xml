<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="rsvBookMapper">
	<resultMap type="ReservationBook" id="rsvBookResultMap">
		<id property="rsvNo" column="RSV_NO"/>
		<result property="bookNo" column="BOOK_NO"/>
		<result property="userId" column="USER_ID"/>
		<result property="rsvDate" column="RSV_DATE"/>
		<result property="rsvState" column="RSV_STATE"/>
		<collection property="book" resultMap="bookResultMap"/>
	</resultMap>
	<resultMap type="Book" id="bookResultMap">
		<id property="bookNo" column="BOOK_NO"/>
		<result property="bookName" column="BOOK_NAME"/>
		<result property="bookWriter" column="BOOK_WRITER"/>
		<result property="bookSubject" column="BOOK_SUBJECT"/>
		<result property="publisher" column="PUBLISHER"/>
		<result property="bookYear" column="BOOK_YEAR"/>
		<result property="callNo" column="CALL_NO"/>
		<result property="isbn" column="ISBN"/>
		<result property="bookCover" column="BOOK_COVER"/>
		<result property="theme" column="THEME"/>
		<result property="bookState" column="BOOK_STATE"/>
		<result property="updateDate" column="UPDATE_DATE"/>
		<result property="lendingCount" column="LENDING_COUNT"/>
	</resultMap>
	<!-- 도서 예약 중복 여부 -->
	<select id="addCheck" resultMap="rsvBookResultMap">
		SELECT * FROM BOOK_RESERVATION WHERE BOOK_NO = #{ bookNo } AND USER_ID = #{ userId } AND RSV_STATE = '대기'
	</select>
	<!-- 도서 예약 목록 조회 -->
	<select id="selectAllRsvBook" resultMap="rsvBookResultMap">
		SELECT * FROM BOOK_RESERVATION JOIN BOOK USING (BOOK_NO) WHERE USER_ID = #{ userId }
	</select>
	<!-- 도서 예약 추가 -->
	<insert id="insertRsv" parameterType="ReservationBook">
		INSERT INTO BOOK_RESERVATION VALUES(SEQ_RSV_NO.NEXTVAL, #{ bookNo }, #{ userId }, DEFAULT, DEFAULT)
	</insert>
	<!-- 도서 예약 삭제 -->
	<delete id="deleteRsv" parameterType="_int">
		DELETE FROM BOOK_RESERVATION WHERE RSV_NO = #{ rsvNo }
	</delete>
</mapper>